<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Temo Connect | Consumer Home</title>
  <link rel="icon" href="../images/logo.png" type="image/png">
  <link rel="stylesheet" href="consumer-style.css">
</head>
<body>
  <!-- Navigation -->
  <header>
    <div class="logo">
      <img src="../images/logo2.png" alt="Temo Connect Logo">
      Temo Connect
    </div>

    <nav>
      <ul>
        <li><a href="consumer-product.html">Products</a></li>
        <li><a href="consumer-contact.html">Contact</a></li>
        <li><a href="consumer-about.html">About us</a></li>
        <li><a href="consumer-profile.html">My Account</a></li>
        <li>
        <a href="cart.html" id="cartBtn">
          🛒 Cart <span id="cartCount">0</span>
        </a>
        </li>
      <li><a href="../index.html" id="logoutBtn">Logout</a></li>
      </ul>
    </nav>
  </header>

  <!-- Hero Section -->
  <section class="hero">
    <div class="hero-search">
      <input type="text" id="searchInput" placeholder="🔍 Search products..." oninput="filterProducts()">
    </div>

    <h1>Welcome back to Temo Connect!</h1>
    <p>Browse fresh produce from verified farmers and support your local community.</p>
    <a href="#productGrid" class="btn">Shop Now</a>
  </section>

  <!-- Products Section -->
  <section class="products-section">
    <h2>Featured Products</h2>
    <div class="product-grid" id="productGrid"></div>

    <div class="see-more-container" style="text-align: right; margin-top: 1rem;">
      <button class="btn" onclick="loadMoreProducts()">See More →</button>
    </div>
  </section>

  <!-- Intro Section -->
  <section class="intro">
    <h2>About Temo Connect</h2>
    <p>
      Temo Connect is a platform where farmers can sell their fresh produce directly to consumers.  
      All farmers are verified by our admin before they can post products online.  
      Consumers can browse farm-fresh items, place orders, and support local communities.
    </p>
  </section>

  <!-- Footer -->
  <footer>
    <p>&copy; 2025 Temo Connect. All rights reserved.</p>
  </footer>

  <!-- Scripts -->
  <script>
    const token = localStorage.getItem('token');
    if (!token) window.location.href = '../consumer-login.html';

    let allProducts = [];
    let currentCount = 0;
    const perPage = 8;

    async function loadProducts() {
      try {
        const res = await fetch("http://localhost:5000/api/products", {
          headers: { Authorization: `Bearer ${token}` }
        });
        allProducts = await res.json();
        currentCount = 0;
        renderProducts();
      } catch(err) {
        console.error("Error loading products:", err);
        document.getElementById("productGrid").innerHTML = "<p>Failed to load products.</p>";
      }
    }

    function renderProducts() {
      const grid = document.getElementById("productGrid");
      const productsToShow = allProducts.slice(0, currentCount + perPage);
      grid.innerHTML = productsToShow.map(p => `
        <div class="product-card">
          <img src="${p.image_url || '../images/placeholder.jpg'}" alt="${p.name}">
          <h3>${p.name}</h3>
          <p>Price: R${p.price}</p>
          <p>Farmer: ${p.farmer_name}</p>
          <p>${p.description || 'No description available.'}</p>
          <a href="#" class="btn">Buy</a>
        </div>
      `).join("");
      currentCount += perPage;
    }

    function loadMoreProducts() {
      if(currentCount < allProducts.length) renderProducts();
    }

    function filterProducts() {
      const input = document.getElementById('searchInput').value.toLowerCase();
      const cards = document.querySelectorAll('.product-card');
      cards.forEach(card => {
        const productName = card.querySelector('h3').textContent.toLowerCase();
        card.style.display = productName.includes(input) ? '' : 'none';
      });
    }

    document.getElementById('logoutBtn').addEventListener('click', () => {
      localStorage.removeItem('token');
      window.location.href = '../consumer-login.html';
    });

    document.addEventListener("DOMContentLoaded", loadProducts);
  </script>
</body>
</html>
